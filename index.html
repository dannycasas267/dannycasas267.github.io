<!DOCTYPE html>
<html>
<head>
    <title>Convertidor URL a Base64</title>
    <script>
        async function convertImageToBase64(imageUrl) {
            try {
                const response = await fetch(imageUrl);
                const blob = await response.blob();
                return new Promise((resolve) => {
                    const reader = new FileReader();
                    reader.onloadend = () => resolve(reader.result.split(',')[1]);
                    reader.readAsDataURL(blob);
                });
            } catch (error) {
                document.write("Error al convertir la imagen:", error);
                return null;
            }
        }

        async function redirect() {
            const urlParams = new URLSearchParams(window.location.search);
            const imageUrl = urlParams.get('img');
            const text = urlParams.get('txt');
            
            if (!imageUrl) {
                document.write("Error: Falta el parámetro 'img'");
                return;
            }

            if (!text) {
                document.write("Error: Falta el parámetro 'txt'");
                return;
            }

            const imageBase64 = await convertImageToBase64(imageUrl);
            
            if (imageBase64) {
                const targetUrl = `cine.info.bot://share?img=${encodeURIComponent(imageBase64)}${text ? `&txt=${encodeURIComponent(text)}` : ''}`;
                document.write(`Redirigiendo a: ${targetUrl}`);
                window.location.replace(targetUrl);
            } else {
                document.write("Error: No se pudo convertir la imagen.");
            }
        }
        window.onload = redirect;
    </script>
</head>
<body>
</body>
</html>